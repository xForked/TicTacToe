<!DOCTYPE html>
<html lang="en">
<head>
  <meta charset="UTF-8">
  <meta name="viewport" content="width=device-width, initial-scale=1.0">
  <title>Tic Tac Toe</title>
  <style>
    * { margin: 0; padding: 0; box-sizing: border-box; }

    body {
      min-height: 100vh;
      display: flex;
      align-items: center;
      justify-content: center;
      background: #0f0f1a;
      font-family: 'Segoe UI', sans-serif;
      color: #fff;
    }

    .container { text-align: center; }

    h1 {
      font-size: 2.5rem;
      letter-spacing: 4px;
      margin-bottom: 1.2rem;
      color: #e2e2e2;
    }

    .toggle-row {
      display: flex;
      justify-content: center;
      gap: 0;
      margin-bottom: 0.8rem;
      border: 1px solid #2a2a4a;
      border-radius: 8px;
      overflow: hidden;
      width: fit-content;
      margin-left: auto;
      margin-right: auto;
    }

    .toggle-btn {
      background: #1a1a2e;
      color: #888;
      border: none;
      padding: 0.5rem 1.4rem;
      font-size: 0.85rem;
      letter-spacing: 1px;
      cursor: pointer;
      transition: background 0.15s, color 0.15s;
    }

    .toggle-btn.active {
      background: #2a2a4a;
      color: #fff;
    }

    .diff-row {
      display: flex;
      justify-content: center;
      gap: 0;
      margin-bottom: 1.5rem;
      border: 1px solid #2a2a4a;
      border-radius: 8px;
      overflow: hidden;
      width: fit-content;
      margin-left: auto;
      margin-right: auto;
      opacity: 0;
      pointer-events: none;
      transition: opacity 0.2s;
    }

    .diff-row.visible {
      opacity: 1;
      pointer-events: all;
    }

    .diff-btn {
      background: #1a1a2e;
      color: #888;
      border: none;
      padding: 0.4rem 1.1rem;
      font-size: 0.78rem;
      letter-spacing: 1px;
      cursor: pointer;
      transition: background 0.15s, color 0.15s;
    }

    .diff-btn.active { background: #2a2a4a; color: #fff; }
    .diff-btn.easy.active { color: #4caf7a; }
    .diff-btn.medium.active { color: #e4a84c; }
    .diff-btn.hard.active { color: #e74c6f; }

    .score {
      display: flex;
      justify-content: center;
      gap: 2rem;
      margin-bottom: 1.5rem;
    }

    .score-box {
      background: #1a1a2e;
      border: 1px solid #2a2a4a;
      border-radius: 10px;
      padding: 0.6rem 1.5rem;
      min-width: 90px;
    }

    .score-box .label {
      font-size: 0.75rem;
      letter-spacing: 2px;
      color: #888;
      text-transform: uppercase;
    }

    .score-box .value { font-size: 1.8rem; font-weight: 700; }
    .score-box.x .value { color: #e74c6f; }
    .score-box.o .value { color: #4cafe4; }
    .score-box.draws .value { color: #aaa; }

    .status {
      font-size: 1.1rem;
      margin-bottom: 1.2rem;
      height: 1.5rem;
      color: #ccc;
      letter-spacing: 1px;
    }

    .status span { font-weight: 700; }
    .status .x { color: #e74c6f; }
    .status .o { color: #4cafe4; }

    .board {
      display: grid;
      grid-template-columns: repeat(3, 110px);
      grid-template-rows: repeat(3, 110px);
      gap: 8px;
      margin: 0 auto 1.5rem;
    }

    .cell {
      background: #1a1a2e;
      border: 1px solid #2a2a4a;
      border-radius: 12px;
      display: flex;
      align-items: center;
      justify-content: center;
      font-size: 3rem;
      font-weight: 700;
      cursor: pointer;
      transition: background 0.15s, transform 0.1s;
      user-select: none;
    }

    .cell:hover:not(.taken) { background: #22223a; transform: scale(1.04); }
    .cell.x { color: #e74c6f; }
    .cell.o { color: #4cafe4; }
    .cell.taken { cursor: default; }
    .cell.win {
      background: #2a1a2e;
      border-color: #a044ff;
      animation: winPulse 0.6s ease forwards;
    }

    @keyframes winPulse {
      0%   { transform: scale(1); box-shadow: 0 0 0 0 rgba(160,68,255,0); }
      40%  { transform: scale(1.12); box-shadow: 0 0 20px 6px rgba(160,68,255,0.5); }
      100% { transform: scale(1.06); box-shadow: 0 0 12px 3px rgba(160,68,255,0.3); }
    }

    .status.pop {
      animation: popIn 0.35s cubic-bezier(0.175,0.885,0.32,1.275) forwards;
    }

    @keyframes popIn {
      0%   { transform: scale(0.5); opacity: 0; }
      100% { transform: scale(1);   opacity: 1; }
    }

    #confetti-canvas {
      position: fixed;
      top: 0; left: 0;
      width: 100%; height: 100%;
      pointer-events: none;
      z-index: 99;
    }

    .btn {
      background: #2a2a4a;
      color: #fff;
      border: 1px solid #3a3a6a;
      border-radius: 8px;
      padding: 0.65rem 2rem;
      font-size: 0.95rem;
      letter-spacing: 1px;
      cursor: pointer;
      transition: background 0.15s;
    }

    .btn:hover { background: #3a3a6a; }
  </style>
</head>
<body>
  <canvas id="confetti-canvas"></canvas>
  <div class="container">
    <h1>TIC TAC TOE</h1>

    <div class="toggle-row">
      <button class="toggle-btn active" id="btn-pvp">2 Players</button>
      <button class="toggle-btn" id="btn-ai">vs AI</button>
    </div>

    <div class="diff-row" id="diff-row">
      <button class="diff-btn easy active" id="diff-easy">Easy</button>
      <button class="diff-btn medium" id="diff-medium">Medium</button>
      <button class="diff-btn hard" id="diff-hard">Hard</button>
    </div>

    <div class="score">
      <div class="score-box x">
        <div class="label" id="label-x">X</div>
        <div class="value" id="score-x">0</div>
      </div>
      <div class="score-box draws">
        <div class="label">Draw</div>
        <div class="value" id="score-d">0</div>
      </div>
      <div class="score-box o">
        <div class="label" id="label-o">O</div>
        <div class="value" id="score-o">0</div>
      </div>
    </div>

    <div class="status" id="status"></div>

    <div class="board">
      <div class="cell" data-i="0"></div>
      <div class="cell" data-i="1"></div>
      <div class="cell" data-i="2"></div>
      <div class="cell" data-i="3"></div>
      <div class="cell" data-i="4"></div>
      <div class="cell" data-i="5"></div>
      <div class="cell" data-i="6"></div>
      <div class="cell" data-i="7"></div>
      <div class="cell" data-i="8"></div>
    </div>

    <button class="btn" id="restart">New Game</button>
  </div>

  <script>
    const cells = document.querySelectorAll('.cell');
    const statusEl = document.getElementById('status');
    const diffRow = document.getElementById('diff-row');
    const scoreX = document.getElementById('score-x');
    const scoreO = document.getElementById('score-o');
    const scoreD = document.getElementById('score-d');
    const labelX = document.getElementById('label-x');
    const labelO = document.getElementById('label-o');

    const WINS = [[0,1,2],[3,4,5],[6,7,8],[0,3,6],[1,4,7],[2,5,8],[0,4,8],[2,4,6]];

    let board, current, over, scores, nextStarter;
    let aiMode = false;
    let difficulty = 'easy'; // easy | medium | hard

    // --- Mode toggle ---
    document.getElementById('btn-pvp').addEventListener('click', () => setMode(false));
    document.getElementById('btn-ai').addEventListener('click',  () => setMode(true));

    function setMode(ai) {
      aiMode = ai;
      document.getElementById('btn-pvp').classList.toggle('active', !ai);
      document.getElementById('btn-ai').classList.toggle('active', ai);
      diffRow.classList.toggle('visible', ai);
      labelX.textContent = ai ? 'You' : 'X';
      labelO.textContent = ai ? 'AI'  : 'O';
      resetScores();
    }

    // --- Difficulty ---
    ['easy','medium','hard'].forEach(d => {
      document.getElementById('diff-' + d).addEventListener('click', () => {
        difficulty = d;
        document.querySelectorAll('.diff-btn').forEach(b => b.classList.remove('active'));
        document.getElementById('diff-' + d).classList.add('active');
        resetScores();
      });
    });

    // --- Score / init ---
    function resetScores() {
      scores = { X: 0, O: 0, D: 0 };
      nextStarter = 'X';
      updateScores();
      init();
    }

    function init() {
      stopConfetti();
      board = Array(9).fill('');
      current = aiMode ? 'X' : (nextStarter || 'X');
      if (!aiMode) nextStarter = current === 'X' ? 'O' : 'X';
      over = false;
      cells.forEach(c => { c.textContent = ''; c.className = 'cell'; });
      if (!scores) scores = { X: 0, O: 0, D: 0 };
      setStatus();
    }

    function setStatus(msg) {
      if (msg) {
        statusEl.innerHTML = msg;
        statusEl.classList.remove('pop');
        void statusEl.offsetWidth;
        statusEl.classList.add('pop');
        return;
      }
      statusEl.classList.remove('pop');
      if (aiMode) {
        const label = current === 'X' ? 'Your' : "AI's";
        statusEl.innerHTML = `<span class="${current.toLowerCase()}">${label}</span> turn`;
      } else {
        statusEl.innerHTML = `Player <span class="${current.toLowerCase()}">${current}</span>'s turn`;
      }
    }

    function checkWinOn(b) {
      for (const [a, i, c] of WINS)
        if (b[a] && b[a] === b[i] && b[a] === b[c]) return b[a];
      return null;
    }

    function checkWin() {
      for (const [a, b, c] of WINS)
        if (board[a] && board[a] === board[b] && board[a] === board[c]) return [a, b, c];
      return null;
    }

    function playMove(i) {
      board[i] = current;
      cells[i].textContent = current;
      cells[i].classList.add('taken', current.toLowerCase());

      const win = checkWin();
      if (win) {
        win.forEach((idx, n) => {
          setTimeout(() => cells[idx].classList.add('win'), n * 80);
        });
        scores[current]++;
        updateScores();
        const msg = aiMode
          ? (current === 'X' ? 'You win! ðŸŽ‰' : 'AI wins!')
          : `Player <span class="${current.toLowerCase()}">${current}</span> wins!`;
        setTimeout(() => { setStatus(msg); launchConfetti(); }, 250);
        over = true;
      } else if (board.every(Boolean)) {
        scores.D++;
        updateScores();
        setStatus("It's a draw!");
        over = true;
      } else {
        current = current === 'X' ? 'O' : 'X';
        setStatus();
        if (aiMode && current === 'O') triggerAI();
      }
    }

    cells.forEach(cell => {
      cell.addEventListener('click', () => {
        const i = +cell.dataset.i;
        if (over || board[i]) return;
        if (aiMode && current === 'O') return;
        playMove(i);
      });
    });

    // --- AI ---
    function minimax(b, isMax) {
      const w = checkWinOn(b);
      if (w === 'O') return 10;
      if (w === 'X') return -10;
      if (b.every(Boolean)) return 0;

      let best = isMax ? -Infinity : Infinity;
      for (let i = 0; i < 9; i++) {
        if (!b[i]) {
          b[i] = isMax ? 'O' : 'X';
          const val = minimax(b, !isMax);
          b[i] = '';
          best = isMax ? Math.max(best, val) : Math.min(best, val);
        }
      }
      return best;
    }

    function getRandomMove() {
      const empty = board.map((v, i) => v ? null : i).filter(i => i !== null);
      return empty[Math.floor(Math.random() * empty.length)];
    }

    function getBestMove() {
      let bestVal = -Infinity, bestMove = -1;
      for (let i = 0; i < 9; i++) {
        if (!board[i]) {
          board[i] = 'O';
          const val = minimax(board, false);
          board[i] = '';
          if (val > bestVal) { bestVal = val; bestMove = i; }
        }
      }
      return bestMove;
    }

    function getAIMove() {
      if (difficulty === 'easy') {
        // 90% random, 10% optimal
        return Math.random() < 0.9 ? getRandomMove() : getBestMove();
      }
      if (difficulty === 'medium') {
        // 50% random, 50% optimal
        return Math.random() < 0.5 ? getRandomMove() : getBestMove();
      }
      // hard: always optimal
      return getBestMove();
    }

    function triggerAI() {
      setTimeout(() => {
        if (over) return;
        playMove(getAIMove());
      }, 400);
    }

    // --- Confetti ---
    const canvas = document.getElementById('confetti-canvas');
    const ctx = canvas.getContext('2d');
    let confettiPieces = [];
    let confettiAnim = null;
    const COLORS = ['#e74c6f','#4cafe4','#a044ff','#f0c040','#4caf7a','#ff7b54'];

    function launchConfetti() {
      canvas.width  = window.innerWidth;
      canvas.height = window.innerHeight;
      confettiPieces = Array.from({ length: 90 }, () => ({
        x: Math.random() * canvas.width,
        y: Math.random() * -canvas.height * 0.3,
        w: 8 + Math.random() * 8,
        h: 6 + Math.random() * 6,
        color: COLORS[Math.floor(Math.random() * COLORS.length)],
        vx: (Math.random() - 0.5) * 3,
        vy: 2 + Math.random() * 4,
        angle: Math.random() * 360,
        spin: (Math.random() - 0.5) * 6,
        life: 1,
        decay: 0.008 + Math.random() * 0.006
      }));
      if (confettiAnim) cancelAnimationFrame(confettiAnim);
      animateConfetti();
    }

    function animateConfetti() {
      ctx.clearRect(0, 0, canvas.width, canvas.height);
      confettiPieces.forEach(p => {
        p.x += p.vx;
        p.y += p.vy;
        p.vy += 0.1;
        p.angle += p.spin;
        p.life -= p.decay;
        if (p.life <= 0) return;
        ctx.save();
        ctx.translate(p.x, p.y);
        ctx.rotate(p.angle * Math.PI / 180);
        ctx.globalAlpha = p.life;
        ctx.fillStyle = p.color;
        ctx.fillRect(-p.w / 2, -p.h / 2, p.w, p.h);
        ctx.restore();
      });
      confettiPieces = confettiPieces.filter(p => p.life > 0);
      if (confettiPieces.length > 0) {
        confettiAnim = requestAnimationFrame(animateConfetti);
      } else {
        ctx.clearRect(0, 0, canvas.width, canvas.height);
      }
    }

    function stopConfetti() {
      if (confettiAnim) { cancelAnimationFrame(confettiAnim); confettiAnim = null; }
      ctx.clearRect(0, 0, canvas.width, canvas.height);
    }

    function updateScores() {
      scoreX.textContent = scores.X;
      scoreO.textContent = scores.O;
      scoreD.textContent = scores.D;
    }

    document.getElementById('restart').addEventListener('click', init);
    init();
  </script>
</body>
</html>
